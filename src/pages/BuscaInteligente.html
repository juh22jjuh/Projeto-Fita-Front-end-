<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Alocação Inteligente</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
    <style>
        body {
            background-color: #1068a6;
            padding: 30px;
            color: #ffffff;
        }

        .text-dark,
        .text-primary,
        .bi-stars {
            color: #ffffff !important;
        }

        .bg-gradient-primary {
            background: linear-gradient(90deg, #0d6efd, #0b4e7e);
            color: #fff;
        }

        .container.bg-white {
            background-color: #ffffff !important;
        }

        .container {
            color: #212529;
        }

        .container h3,
        .container h5 {
            color: #212529 !important;
        }

        .container .form-label,
        .container .form-check-label {
            color: #212529;
        }
        
        .container .text-muted, .container .small.text-muted {
            color: #6c757d !important;
        }

        .room-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .room-card.selected {
            border: 2px solid #0d6efd;
            box-shadow: 0 0 10px rgba(13, 110, 253, 0.3);
        }

        .time-btn.btn-primary {
            color: #fff !important;
        }
        
    </style>
</head>

<body>
    <div class="container bg-white p-4 rounded shadow-lg" style="max-width: 900px;">
        <div class="d-flex align-items-center mb-4">
            <a href="AlocacaoSala.html" class="fs-4 me-4 text-center cursor-pointer text-dark text-decoration-none">
                <i class="bi bi-arrow-left"  style="color: black;"></i>
            </a>
            <i class="bi bi-stars text-danger fs-4 me-2"></i>
            <h3 class="m-0">Alocação Inteligente</h3>
        </div>

        <form id="smartForm" class="needs-validation" novalidate>
            <div class="mb-3">
                <label class="form-label">Data</label>
                <input type="date" class="form-control" id="date" required />
            </div>

            <div class="mb-3">
                <label for="activityName" class="form-label">Nome da Atividade</label>
                <input type="text" id="activityName" class="form-control" placeholder="Ex: Workshop de React"
                    required />
            </div>

            <div class="mb-3">
                <label for="speakerName" class="form-label">Nome do Palestrante</label>
                <input type="text" id="speakerName" class="form-control" placeholder="Seu nome" required />
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="participants" class="form-label">Número de Participantes</label>
                    <input type="number" id="participants" class="form-control" min="1" value="10" required />
                </div>

                <div class="col-md-6 mb-3">
                    <label for="duration" class="form-label">Duração (horas)</label>
                    <input type="number" id="duration" class="form-control" min="1" max="4" value="1" required />
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label d-block">Tipo de Sala</label>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="type" id="teorica" value="teorica" checked />
                    <label class="form-check-label" for="teorica">Teórica</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="type" id="pratica" value="pratica" />
                    <label class="form-check-label" for="pratica">Prática</label>
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label">Equipamentos Necessários</label>
                <div class="row row-cols-2 ms-2">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="projector" id="eq1" />
                        <label class="form-check-label" for="eq1">Microfone</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="sound" id="eq2" />
                        <label class="form-check-label" for="eq2">Sistema de Som</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="videoconf" id="eq3" />
                        <label class="form-check-label" for="eq3">Projetor</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="tv" id="eq4" />
                        <label class="form-check-label" for="eq4">TV</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="computer" id="eq5" />
                        <label class="form-check-label" for="eq5">Computadores</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="microphone" id="eq6" />
                        <label class="form-check-label" for="eq6">Quadro Branco</label>
                    </div>
                </div>
            </div>

            <button type="submit" class="btn bg-gradient-primary w-100 mb-3">
                <i class="bi bi-stars me-2"></i>Buscar Salas Ideais
            </button>
        </form>

        <div id="suggestionsSection" class="mt-4 d-none">
            <h5 class="fw-bold mb-3">Sugestões do Sistema</h5>
            <div id="suggestionsList" class="vstack gap-3"></div>
            <button id="confirmBtn" class="btn btn-primary w-100 mt-3" disabled>Confirmar Alocação</button>
        </div>
    </div>

    <script>
        const rooms = [
            {
                id: "1",
                name: "Sala A",
                capacity: 40,
                type: "teorica",
                equipment: ["projector", "microphone", "whiteboard"],
                availableSlots: ["08:00", "10:00", "13:00"],
            },
            {
                id: "2",
                name: "Laboratório 2",
                capacity: 20,
                type: "pratica",
                equipment: ["computer", "sound", "tv"],
                availableSlots: ["09:00", "11:00", "15:00"],
            },
            {
                id: "3",
                name: "Auditório Central",
                capacity: 100,
                type: "teorica",
                equipment: ["sound", "microphone", "projector"],
                availableSlots: ["10:00", "14:00"],
            },
        ];

        const form = document.getElementById("smartForm");
        const suggestionsList = document.getElementById("suggestionsList");
        const suggestionsSection = document.getElementById("suggestionsSection");
        const confirmBtn = document.getElementById("confirmBtn");

        const dateInput = document.getElementById("date");
        const today = new Date().toISOString().split("T")[0];
        dateInput.min = today;

        let selectedRoom = null;
        let selectedTime = null;

        form.addEventListener("submit", (e) => {
            e.preventDefault();
            if (!form.checkValidity()) {
                form.classList.add("was-validated");
                return;
            }

            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            const requiredEquipment = Array.from(document.querySelectorAll("input[type=checkbox]:checked")).map(
                (c) => c.value
            );

            const results = rooms
                .map((r) => ({

                    ...r,
                    score: calculateSuitability(r, {
                        ...data,
                        participants: +data.participants,
                        duration: +data.duration,
                        requiredEquipment,
                    }),
                }))
                .filter((r) => r.score > 0)
                .sort((a, b) => b.score - a.score)
                .slice(0, 3);

            showSuggestions(results);
        });

        function calculateSuitability(room, data) {
            if (room.capacity < data.participants) return -1;
            let score = 0;

            const ratio = data.participants / room.capacity;
            if (ratio >= 0.5) score += 30;
            else if (ratio >= 0.3) score += 20;
            else score += 10;

            if (room.type === data.type) score += 25;

            const eqMatch = data.requiredEquipment.filter((eq) => room.equipment.includes(eq)).length;
            score += (eqMatch / Math.max(data.requiredEquipment.length, 1)) * 30;

            if (room.availableSlots.length > 0) score += 15;
            return score;
        }

        function showSuggestions(results) {
            suggestionsList.innerHTML = "";
            selectedRoom = null;
            selectedTime = null;
            confirmBtn.disabled = true;

            if (results.length === 0) {
                suggestionsList.innerHTML = `<div class="alert alert-warning">Nenhuma sala adequada encontrada.</div>`;
                suggestionsSection.classList.remove("d-none");
                return;
            }

            results.forEach((room, index) => {
                const card = document.createElement("div");
                card.className = "card room-card";
                card.innerHTML = `
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <h5 class="card-title mb-1">${room.name}</h5>
                ${index === 0 ? `<span class="badge bg-primary">Melhor opção</span>` : ""}
                <p class="text-muted mb-0">Capacidade: ${room.capacity} • Tipo: ${room.type}</p>
              </div>
            </div>
            <div class="mt-2 small text-muted">${room.availableSlots.length} horários disponíveis</div>
            <div class="mt-3 d-none time-section">
              <label class="form-label">Escolha o horário:</label>
              <div class="d-flex flex-wrap gap-2">
                ${room.availableSlots
                            .map(
                                (slot) =>
                                    `<button type="button" class="btn btn-outline-secondary btn-sm time-btn" data-time="${slot}">${slot}</button>`
                            )
                            .join("")}
              </div>
            </div>
          </div>
        `;
                suggestionsList.appendChild(card);

                card.addEventListener("click", () => {
                    document.querySelectorAll(".room-card").forEach((c) => c.classList.remove("selected"));
                    card.classList.add("selected");
                    selectedRoom = room.id;
                    selectedTime = null;
                    confirmBtn.disabled = true;

                    document.querySelectorAll(".time-section").forEach((ts) => ts.classList.add("d-none"));
                    card.querySelector(".time-section").classList.remove("d-none");

                    card.querySelectorAll(".time-btn").forEach((btn) => {
                        btn.addEventListener("click", (ev) => {
                            ev.stopPropagation();
                            card.querySelectorAll(".time-btn").forEach((b) => {
                                b.classList.remove("btn-primary");
                                b.classList.add("btn-outline-secondary");
                            });
                            btn.classList.remove("btn-outline-secondary");
                            btn.classList.add("btn-primary");
                            selectedTime = btn.dataset.time;
                            confirmBtn.disabled = false;
                        });
                    });
                });
            });

            suggestionsSection.classList.remove("d-none");
        }

        confirmBtn.addEventListener("click", () => {
            if (!selectedRoom || !selectedTime) return;
            alert(`Sala alocada com sucesso!\n\nSala: ${selectedRoom}\nHorário: ${selectedTime}`);
            suggestionsSection.classList.add("d-none");
            form.reset();
            form.classList.remove("was-validated");
        });
    </script>

    <div vw class="enabled">
        <div vw-access-button class="active"></div>
        <div vw-plugin-wrapper>
            <div class="vw-plugin-top-wrapper"></div>
        </div>
    </div>

    <script src="https://vlibras.gov.br/app/vlibras-plugin.js"></script>
    <script>
        new window.VLibras.Widget('https://vlibras.gov.br/app');
    </script>
</body>

</html>